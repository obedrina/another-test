version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
global_job_config:
  prologue:
    commands:
      - echo cole
blocks:
  - name: 'Block #1'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - checkout
            - sudo service docker stop && sudo umount /var/lib/docker && sudo service docker start
            - cat /tmp/system-metrics
            - cache store
  - name: 'Block #2'
    task:
      jobs:
        - name: Push 100Mb Artifact
          commands:
            - truncate -s 100M 100MB_file.txt
            - artifact push workflow 100MB_file.txt
  - name: 'Block #3'
    task:
      jobs:
        - name: Pull 100Mb Artifact
          commands:
            - artifact pull workflow 100MB_file.txt
            - ls
promotions:
  - name: Deploy
    pipeline_file: pipeline_2.yml
    parameters:
      env_vars:
        - required: true
          options:
            - Stage
            - Production
          default_value: Stage
          description: Where to deploy?
          name: ENVIRONMENT
